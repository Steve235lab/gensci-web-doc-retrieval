# 用户注册

**王义成 2022/6/15**

---

**模块时间轴**

用户输入用户名、密码、邮箱 -> 点击注册 -> 发送sign_up请求、并接收token，显示验证码输入框和验证按钮、隐藏之前的3个输入框和注册按钮 -> 用户查看邮件输入验证码 -> 点击验证按钮 -> 发送email_confirm请求，接收验证结果 -> 跳转至下一个模块 

---

* 用户输入信息并点击“注册”按钮

* 前端 -> 后端 发送用户注册信息

  以json的形式向后端发送用户注册信息

  url: 42.192.44.52:8000/sign_up/

  ```
  {
    "message_type": "sign_up",
    "username": username,
    "password": password,
    "email": email
  }
  ```
  
  > username 和 email 均为用户输入的原始信息，password为md5加密后的值，三者均使用字符串类型。

* 后端 -> 前端 发送token
  
  后端接收到 "sign_up" 消息后会判断用户输入的邮箱是否已被占用，若被占用，则向前端发送
  ```
  {
    "message_type": "rsp_sign_up",
    "token": "None",
    "result": "email_occupied"
  }
  ```

  若邮箱可用，则分配 uuid 并创建新的用户对象，完成后以json的形式向前端发送token
  ```
  {
    "message_type": "rsp_sign_up",
    "token": token,
    "result": "success"
  }
  ```
  
  > token示例：eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1dWlkIjoiMDAxIiwiZXhwIjoxNjU1NDUzMzg2LjEyODI2LCJzYWx0IjoiU3RldmUyMzVMYWIifQ.vLmc5nNmJc4xBN83CMneKEYG2GmIDan-p_fP91n7WTE

* 跳转至邮箱验证界面

  后端会生成随机的邮箱验证码，并发送至用户填写的邮箱；在验证界面会要求用户输入该验证码。用户输入验证码并点击“验证”按钮后向后端以json的形式发送用户输入的验证码

  url: 42.192.44.52:8000/sign_up/email_confirm/

  ```
  {
    "message_type": "email_confirm",
    "token": token,
    "confirm_code": confirm_code
  }
  ```

* 后端 -> 前端 发送邮箱验证结果

  后端会将用户输入的验证码与数据库中的值进行比对，如果二者相同，则发送
  
  ```
  {
    "message_type": "rsp_email_confirm",
    "token": token,
    "confirmed": True
  }
  ```

  如果不同，则发送

  ```
  {
    "message_type": "rsp_email_confirm",
    "token": token,
    "confirmed": False
  }
  ```
* 前端向用户显示验证结果
